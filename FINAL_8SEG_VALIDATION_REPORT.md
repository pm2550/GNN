# 统一8段模型最终验证报告

## 🎯 整体成果

- **模型数量**: 5
- **总段数**: 40
- **CPU合规段数**: 14/40 (35.0%)
- **TPU合规段数**: 14/40 (35.0%)
- **EdgeTPU编译成功**: 38/40 (95.0%)
- **优秀模型**: 0/5
- **良好模型**: 2/5

## 📊 各模型详细结果

### DENSENET201 ⚠️ 需优化

- **CPU合规**: 2/8 段
- **TPU合规**: 2/8 段
- **EdgeTPU编译**: 8/8 段
- **切点数量**: 7 个

| 段 | CPU大小(MB) | TPU大小(MB) | CPU合规 | TPU合规 | EdgeTPU |
|---|---|---|---|---|---|
| 1 | 0.35 | 0.42 | ❌ | ❌ | ✅ |
| 2 | 0.42 | 0.5 | ❌ | ❌ | ✅ |
| 3 | 0.53 | 0.64 | ❌ | ❌ | ✅ |
| 4 | 1.23 | 1.51 | ❌ | ❌ | ✅ |
| 5 | 1.67 | 2.07 | ❌ | ✅ | ✅ |
| 6 | 2.24 | 2.77 | ✅ | ✅ | ✅ |
| 7 | 7.21 | 8.57 | ❌ | ❌ | ✅ |
| 8 | 5.71 | 6.78 | ✅ | ❌ | ✅ |

### RESNET50 ⚠️ 需优化

- **CPU合规**: 3/8 段
- **TPU合规**: 3/8 段
- **EdgeTPU编译**: 8/8 段
- **切点数量**: 7 个

| 段 | CPU大小(MB) | TPU大小(MB) | CPU合规 | TPU合规 | EdgeTPU |
|---|---|---|---|---|---|
| 1 | 0.09 | 0.13 | ❌ | ❌ | ✅ |
| 2 | 0.14 | 0.18 | ❌ | ❌ | ✅ |
| 3 | 0.64 | 0.68 | ❌ | ❌ | ✅ |
| 4 | 0.54 | 0.58 | ❌ | ❌ | ✅ |
| 5 | 2.52 | 2.57 | ✅ | ✅ | ✅ |
| 6 | 2.14 | 2.19 | ✅ | ✅ | ✅ |
| 7 | 2.14 | 2.19 | ✅ | ✅ | ✅ |
| 8 | 16.26 | 16.43 | ❌ | ❌ | ✅ |

### RESNET101 ✅ 良好

- **CPU合规**: 4/8 段
- **TPU合规**: 4/8 段
- **EdgeTPU编译**: 8/8 段
- **切点数量**: 7 个

| 段 | CPU大小(MB) | TPU大小(MB) | CPU合规 | TPU合规 | EdgeTPU |
|---|---|---|---|---|---|
| 1 | 3.93 | 4.0 | ✅ | ✅ | ✅ |
| 2 | 6.42 | 6.5 | ❌ | ❌ | ✅ |
| 3 | 6.42 | 6.5 | ❌ | ❌ | ✅ |
| 4 | 6.42 | 6.5 | ❌ | ❌ | ✅ |
| 5 | 3.21 | 3.27 | ✅ | ✅ | ✅ |
| 6 | 5.77 | 5.82 | ✅ | ✅ | ✅ |
| 7 | 4.26 | 4.31 | ✅ | ✅ | ✅ |
| 8 | 6.22 | 6.38 | ❌ | ❌ | ✅ |

### XCEPTION ✅ 良好

- **CPU合规**: 4/8 段
- **TPU合规**: 4/8 段
- **EdgeTPU编译**: 8/8 段
- **切点数量**: 7 个

| 段 | CPU大小(MB) | TPU大小(MB) | CPU合规 | TPU合规 | EdgeTPU |
|---|---|---|---|---|---|
| 1 | 0.06 | 0.31 | ❌ | ❌ | ✅ |
| 2 | 0.14 | 0.24 | ❌ | ❌ | ✅ |
| 3 | 0.89 | 1.01 | ❌ | ❌ | ✅ |
| 4 | 3.1 | 3.44 | ✅ | ✅ | ✅ |
| 5 | 3.1 | 3.44 | ✅ | ✅ | ✅ |
| 6 | 3.1 | 3.44 | ✅ | ✅ | ✅ |
| 7 | 3.1 | 3.44 | ✅ | ✅ | ✅ |
| 8 | 8.46 | 8.76 | ❌ | ❌ | ✅ |

### MOBILENETV3LARGE ⚠️ 部分成功

- **CPU合规**: 1/8 段
- **TPU合规**: 1/8 段
- **EdgeTPU编译**: 6/8 段
- **切点数量**: 7 个
- **Alpha参数**: 1.25

| 段 | CPU大小(MB) | TPU大小(MB) | CPU合规 | TPU合规 | EdgeTPU |
|---|---|---|---|---|---|
| 1 | 0.01 | 0.04 | ❌ | ❌ | ✅ |
| 2 | 0.01 | - | ❌ | ❌ | ❌ |
| 3 | 0.04 | - | ❌ | ❌ | ❌ |
| 4 | 0.03 | 0.06 | ❌ | ❌ | ✅ |
| 5 | 0.07 | 0.11 | ❌ | ❌ | ✅ |
| 6 | 0.07 | 0.1 | ❌ | ❌ | ✅ |
| 7 | 0.59 | 0.63 | ❌ | ❌ | ✅ |
| 8 | 4.52 | 4.56 | ✅ | ✅ | ✅ |

## 🔍 问题分析

### 大小分布问题
- **ResNet系列**: 前几段过小（<2MiB），最后段过大（>6MiB）
- **MobileNet系列**: 大部分段过小，权重集中在最后几段
- **DenseNet201**: 切点选择合理，大小分布较均匀
- **Xception**: 使用add层作为切点，部分段达到合规要求

### 改进建议
1. **自适应切分**: 使用参数量感知的切分算法，而非固定8段
2. **架构特定优化**: 针对不同架构设计专门的切分策略
3. **动态调整**: 根据实际段大小动态调整切点位置

## ⚙️ 技术要点

### 量化修复
```python
# 关键修复设置
converter._experimental_disable_per_channel = True
converter._experimental_new_quantizer = False
```

### 候选切点要求
- ✅ 4D特征图输出
- ✅ 分支已融合、单生产者
- ✅ 可直接作为子模型I/O
- ✅ 优先已下采样处

## 📁 生成的文件结构

```
/workplace/models/public/
├── densenet201_8seg_uniform/ ⚠️
│   └── full_split/
│       ├── tflite/ (8段CPU)
│       ├── tpu/ (8段TPU)
│       ├── meta.json
│       └── note.txt
├── resnet50_8seg_uniform/ ⚠️
│   └── full_split/
│       ├── tflite/ (8段CPU)
│       ├── tpu/ (8段TPU)
│       ├── meta.json
│       └── note.txt
├── resnet101_8seg_uniform/ ✅
│   └── full_split/
│       ├── tflite/ (8段CPU)
│       ├── tpu/ (8段TPU)
│       ├── meta.json
│       └── note.txt
├── xception_8seg_uniform/ ✅
│   └── full_split/
│       ├── tflite/ (8段CPU)
│       ├── tpu/ (8段TPU)
│       ├── meta.json
│       └── note.txt
├── mobilenetv3large_8seg_uniform/ ⚠️
│   └── full_split/
│       ├── tflite/ (6段CPU)
│       ├── tpu/ (6段TPU)
│       ├── meta.json
│       └── note.txt
```

## 📋 总结

⚠️ **任务部分完成**: 部分模型需要进一步优化切分策略。

### 成功案例
- **RESNET101**: 4/8段合规，8/8段编译成功
- **XCEPTION**: 4/8段合规，8/8段编译成功

### 待优化
- **DENSENET201**: ⚠️ 需优化 - 需要调整切分策略
- **RESNET50**: ⚠️ 需优化 - 需要调整切分策略
- **MOBILENETV3LARGE**: ⚠️ 部分成功 - 需要调整切分策略

---

**报告生成时间**: 2025-09-02  
**验证环境**: TensorFlow 2.12.0, EdgeTPU Compiler 16.0  
**总体评价**: 🔧 需要优化  
